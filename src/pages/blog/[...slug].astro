---
import ConvexPost from '../../layouts/ConvexPost.astro';
import BaseHead from '../../components/BaseHead.astro';
import { ConvexHttpClient } from 'convex/browser';
import { api } from '../../../convex/_generated/api';
export const prerender = false;

const slug = Astro.params.slug as string;
const siteSlug = import.meta.env.DEFAULT_SITE_SLUG || '';
let post: any = null;
try {
  const client = new ConvexHttpClient(import.meta.env.CONVEX_URL || import.meta.env.PUBLIC_CONVEX_URL);
  if (siteSlug && slug) {
    post = await client.query(api.posts.getBySlug, { siteSlug, slug });
  }
} catch {}
---

{!post ? (
  <html lang="en"><head><BaseHead title="Not found" description="" /></head><body><p>Post not found.</p></body></html>
) : (
  <ConvexPost title={post.title} description={post.description} createdAt={post.createdAt} updatedAt={post.updatedAt} content={post.content} />
)}
