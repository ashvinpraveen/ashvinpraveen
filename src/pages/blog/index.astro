---
import { Image } from 'astro:assets';
import { ConvexHttpClient } from 'convex/browser';
import { api } from '../../../convex/_generated/api';
import BaseHead from '../../components/BaseHead.astro';
import CardLayout from '../../components/CardLayout.astro';
// Footer removed
import FormattedDate from '../../components/FormattedDate.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../../consts';
export const prerender = false;

let posts: any[] = [];
try {
  const client = new ConvexHttpClient(import.meta.env.CONVEX_URL || import.meta.env.PUBLIC_CONVEX_URL);
  const siteSlug = import.meta.env.DEFAULT_SITE_SLUG || '';
  if (siteSlug) {
    posts = await client.query(api.posts.listBySite, { siteSlug });
  }
} catch {}
---

<!doctype html>
<html lang="en" data-theme="dark">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
		<style>
			main { width: 100%; max-width: 100%; }
			ul {
				display: flex;
				flex-wrap: wrap;
				gap: 2rem;
				list-style-type: none;
				margin: 0;
				padding: 0;
			}
			ul li {
				width: calc(50% - 1rem);
			}
			ul li * {
				text-decoration: none;
				transition: 0.2s ease;
			}
			ul li:first-child { width: 100%; margin-bottom: 1rem; text-align: center; }
			ul li:first-child img {
				width: 100%;
			}
			ul li:first-child .title {
				/* Uses global h4 size */
			}
			ul li img {
				margin-bottom: 0.5rem;
				border-radius: 12px;
			}
			ul li a {
				display: block;
				border-radius: 12px;
				color: inherit;
				overflow: hidden;
			}
			ul li a .meta { padding: 0.75rem 0.9rem 0.9rem; }
			ul li a .title { margin: 0 0 0.25rem 0; }
			.title { margin: 0; line-height: 1.15; }
			.date { margin: 0; }
			/* Clean hover: white outline + subtle background */
			ul li a { transition: box-shadow .2s ease, background-color .2s ease; }
			ul li a:hover {
				box-shadow: 0 0 0 3px hsl(0 0% 100% / 0.9);
				background: hsl(0 0% 100% / 0.04);
			}
			@media (max-width: 720px) {
				ul {
					gap: 0.5em;
				}
				ul li {
					width: 100%;
					text-align: center;
				}
				ul li:first-child {
					margin-bottom: 0;
				}
				ul li:first-child .title {
					/* Uses global h4 size */
				}
			}
		</style>
	</head>
	<body>
		<CardLayout>
			<main>
				<section>
					<h1>Blog</h1>
					<ul>
						{
							posts.map((post) => (
								<li>
									<a href={`/blog/${post.slug}/`}>
										<div class="meta">
											<h4 class="title">{post.title}</h4>
											<p class="date">
												{post.publishedAt ? <FormattedDate date={new Date(post.publishedAt)} /> : null}
											</p>
										</div>
									</a>
								</li>
							))
						}
					</ul>
				</section>
			</main>
		</CardLayout>
	</body>
</html>
